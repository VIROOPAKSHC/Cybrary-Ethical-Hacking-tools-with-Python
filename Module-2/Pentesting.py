import nmap
import sys
import time
from pprint import pprint

print("\nRunning...\n")

nm_scan = nmap.PortScanner()
nm_scanner = nm_scan.scan(sys.argv[1],'80',arguments='-O') # -O argument, OS Fingerprinting
# Fingerprinting requires OS Privileges, use sudo
# sys.argv1[1] is a host argument
# For example: '172.217.20.14'
# Use ping google.com to find the IP address


# pprint(nm_scanner)

host_is_up = ("The host is: "+nm_scanner['scan'][sys.argv[1]]['status']['state']+'\n')
port_open = ("The port 80 is: "+nm_scanner['scan'][sys.argv[1]]['tcp'][80]['state']+'\n')
method_scan = ("The scanning method is: "+nm_scanner['scan'][sys.argv[1]]['tcp'][80]['reason']+'\n')
guessed_os = ("There is {} chance that the host is running {}. \n".format(
nm_scanner['scan'][sys.argv[1]]['osmatch'][0]['accuracy']+"%",nm_scanner['scan'][sys.argv[1]]['osmatch'][0]['name']
	))

with open("%s.txt"%sys.argv[1],'w') as f:
	f.write(host_is_up+port_open+method_scan+guessed_os)
	f.write("\n Report generated "+time.strftime("%Y-%m-%d_%H:%M:%S GMT",time.gmtime()))

print("\nFinished...")